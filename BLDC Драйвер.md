инфу брал отсюда https://www.youtube.com/watch?v=8V1rTIZczZw&t=369s

Для отладки и настройки драйверов юзают STM32 Motor SDK. Крутая штука 
![[Pasted image 20230807132701.png]]
https://www.st.com/en/embedded-software/x-cube-mcsdk.html


![[Pasted image 20230807132846.png]]

тут еще приведен офигенный материал для опдбора компонентов и принципа управления BLDC драйверами
https://www.ti.com/seclit/ml/sszp343/sszp343.pdf

ОЧЕНЬ СОВРЕМЕННО использовать готовые трехфазные драйверы которые имеют возможность подключения к МК посредством цифрового интерфейса
![[Pasted image 20230807133316.png]]
https://www.ti.com/product/DRV8320
https://www.ti.com/lit/ds/symlink/drv8320.pdf?ts=1691401320749&ref_url=https%253A%252F%252Fwww.ti.com%252Fproduct%252FDRV8320

Далее важным компонентом будут транзисторы мосфеты. Их уже надо подбирать самим, но самый важный параметр - низкая емкость затвора, чтобы можно было чаще переключать транзистор

Остальные комплектухи подбираются из документа выше 
https://www.ti.com/seclit/ml/sszp343/sszp343.pdf

Кстати, я дурак. Есть готовая утилита от ST которая сама делает модель двигателя для управления 
![[Pasted image 20230807134304.png]]

после калибровки получаем такую штуку ![[Pasted image 20230807134409.png]]
и далее эти параметры просто подгружаются в motor sdk
![[Pasted image 20230807134450.png]]

РАЗУМЕЕТСЯ, ИСПОЛЬЗОВАНИЕ ТАКИХ ГОТОВЫХ БИБЛИОТЕК И КОДОГЕНЕРАТОРОВ НЕ ДАСТ МНОГО ПОНИМАНИЯ КАК РАБОАЕТ ДВИГАТЕЛЬ И АЛГОРИТМЫ УПРАВЛЕНИЯ, НО ЗАМЕЧАТЕЛЬНО ДАСТ БУСТ ПРИ ПРОТОТИПИРОВАНИИ И ИССЛЕДОВАНИИ ПАРАМЕТРОВ ДВИГАТЕЛЯ

<mark style="background: #FFB86CA6;">09.08</mark>

Для нашего конкретно использования датчики положения ротора нах** не нужны. Это несколько упрощает систему управления и компонентную базу
Ну и общая схема драйвера упрощается примерно настолько
![[Pasted image 20230809120443.png]]

Первое и самое главное - необходимо отслеживать на обмотках напряжение и силу тока. Это необходимо для бездатчикового векторного управления двиглом, мониторить расход энергии и определять с какой фазы стартовать.
После двух транзисторов на фазы ставим шунтирующий резистор на входы операционника. По падению напряжения на резисторе можно определить какой ток через него течет, а операционником мы усиливаем сигнал во много раз и подаем на вход ацп МК
Делается примерно так:
![[Pasted image 20230809115113.png]]
Ну а измерение напряжения осуществляется с помощью делителя и небольшого фильтра

Также для адекватной работы необходимо ставить специальные драйверы управления MOS-затворами. Один из многих драйверов показан выше, есть также не на 3 фазы а по одной пихать.
по типу такого
https://www.infineon.com/dgdl/Infineon-IR2103-DataSheet-v01_00-EN.pdf?fileId=5546d462533600a4015355c7b54b166f
Подключать примерно так
![[Pasted image 20230809120702.png]]


![[brushless.gif]]
